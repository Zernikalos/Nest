<html>

<head>
    <script src="http://localhost:7070/mrrobotto-core.js"></script>
</head>

<body>
    <canvas id="sample" width="700" height="700"></canvas>
</body>
<script>
    const vertexShaderSource = `#version 300 es

// an attribute is an input (in) to a vertex shader.
// It will receive data from a buffer
in vec4 a_position;
uniform vec4 u_offset;

// all shaders have a main function
void main() {

  // gl_Position is a special variable a vertex shader
  // is responsible for setting
  mat4 p = mat4(1.3737387097273113, 0, 0, 0, 0, 1.3844710433970557, 0, 0, 0, 0, -1.02020202020202, -1, 0, 0, -2.0202020202020203, 0);
  mat4 v = mat4(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, -6, 1);
  mat4 m = mat4(-0.24608959655537704, 0.8207303996723887, 0.5155982171427886, 0, -0.9688824099139265, -0.22289419717298997, -0.10763388233266194, 0, 0.02658545140868853, -0.5260416218515593, 0.8500431905810325, 0, 0, 0, 0, 1);
  gl_Position = p*v*m * (a_position + u_offset);
}
`;

    const fragmentShaderSource = `#version 300 es

// fragment shaders don't have a default precision so we need
// to pick one. mediump is a good default. It means "medium precision"
precision mediump float;

// we need to declare an output for the fragment shader
out vec4 outColor;

void main() {
  // Just set the output to a constant redish-purple
  outColor = vec4(0.5, 0.5, 0.5, 1);
}
`;

    const fragmentShaderSource2 = `#version 300 es

// fragment shaders don't have a default precision so we need
// to pick one. mediump is a good default. It means "medium precision"
precision mediump float;

// we need to declare an output for the fragment shader
out vec4 outColor;

void main() {
  // Just set the output to a constant redish-purple
  outColor = vec4(0, 0, 0.5, 1);
}
`;

    const vertices = [
    // front
    -1.0, -1.0,  1.0,
     1.0, -1.0,  1.0,
     1.0,  1.0,  1.0,
    -1.0,  1.0,  1.0,
    // back
    -1.0, -1.0, -1.0,
     1.0, -1.0, -1.0,
     1.0,  1.0, -1.0,
    -1.0,  1.0, -1.0
    ];

    const indices = [
		// front
		0, 1, 2,
		2, 3, 0,
		// right
		1, 5, 6,
		6, 2, 1,
		// back
		7, 6, 5,
		5, 4, 7,
		// left
		4, 0, 3,
		3, 7, 4,
		// bottom
		4, 5, 1,
		1, 0, 4,
		// top
		3, 2, 6,
		6, 7, 3
    ];

    const indices2 = [
        0, 1, 2, 3,    // front
        4, 5, 6, 7,    // back
        8, 9, 10, 11,   // top
        12, 13, 14, 15,   // bottom
        16, 17, 18, 19,   // right
        20, 21, 22, 23,   // left
        23, 6,
    ];

    const robotto = new mrrobotto.MrRobotto();
    const canvas = document.getElementById('sample');
    robotto.initialize(canvas);
    const ctx = robotto.ctx;

    const attributes = [{ index: 0, attrName: "a_position" }];
    const uniforms = [{ uniformName: "u_offset", dataType: mrrobotto.MrDataType.FLOAT }];
    const program = new mrrobotto.MrShaderProgram(
        ctx,
        {
            vertexShaderSource,
            fragmentShaderSource,
            attributes,
            uniforms,
        });

    /* const program2 = new mrrobotto.MrShaderProgram(
        ctx,
        {
            vertexShaderSource,
            fragmentShaderSource: fragmentShaderSource2,
            attributes,
        }); */

    // program.initialize();
    // program2.initialize();

    const bufferIndices = [{
        index: 0,
        dataType: mrrobotto.MrDataType.FLOAT,
        size: 3,
        stride: 0,
        pointer: 0,
    }];

    const mesh = new mrrobotto.MrMesh(
        ctx,
        {
            drawMode: mrrobotto.MrMesh.DrawMode.TRIANGLES,
            numFaces: 12,
            indexBufferData: {
                array: indices,
            },
            vertexBufferData: {
                keys: bufferIndices,
                array: vertices,
            },
        });

    const cube = new mrrobotto.MrCube(ctx);

    /* const mesh2 = new mrrobotto.MrMesh(
        ctx,
        {
            drawMode: mrrobotto.MrMesh.DrawMode.LINES,
            numFaces: indices2.length,
            indexBufferData: {
                array: indices2,
            },
            vertexBufferData: {
                indices: bufferIndices,
                array: vertices,
            },
        }); */

    const scene = new mrrobotto.MrScene(ctx, {
        viewPort: { x: 0, y: 0, width: canvas.width, height: canvas.height },
        clearColor: { x: 0.5, y: 0.5, z: 0.5, w: 0.75 },
        clearMask: ctx.gl.COLOR_BUFFER_BIT | ctx.gl.DEPTH_BUFFER_BIT,
    });
    cube.initialize();
    // mesh.initialize();
    //mesh2.initialize();

    scene.initialize();
    scene.render();

    // program.render();
    // mesh.render();
    cube.render();

    // program2.render();
    // mesh2.render();

</script>

</html>
